<!DOCTYPE html>
<html>
    <head>
        <title>Linx</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
        <link rel="stylesheet" type="text/css" media="all" href="{{ url_for('static', filename='css/bootstrap.min.css') }}" />
        <link rel="stylesheet" type="text/css" media="all" href="{{ url_for('static', filename='css/mab-jquery-taginput.css') }}" />
        <link rel="stylesheet" type="text/css" media="all" href="{{ url_for('static', filename='css/main.css') }}" />
    </head>
    <body>
        <div class="container">
            <!-- Static navbar -->
            <div class="navbar navbar-default" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="/">Linx</a>
                </div>
                <div class="navbar-collapse collapse">
                    <form class="navbar-form navbar-right" role="form" action="/">
                        <div class="form-group">
                            <input type="text" placeholder="Enter tags..." id="q" name="q" class="form-control" value="{% block query %}{% endblock %}">
                        </div>
                        <button type="submit" class="btn btn-primary">Search</button>
                    </form>
                </div><!--/.nav-collapse -->
            </div>
            {% block body %}{% endblock %}
        </div> <!-- /container -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/typeahead.bundle.js') }}"></script>
        <script type="text/javascript" src="{{ url_for('static', filename='js/mab-jquery-taginput.js') }}"></script>
        <script type="text/javascript">

            $(function(){

                // Instantiate the Bloodhound suggestion engine
                var tags = new Bloodhound({
                    datumTokenizer: function(d) { return Bloodhound.tokenizers.whitespace(d.tag); },
                    queryTokenizer: Bloodhound.tokenizers.whitespace,
                    // local: [
                    //     { tag: 'tag1' },
                    //     { tag: 'tag2' },
                    //     { tag: 'tag3' }
                    // ]
                    prefetch: {
                        // Currently this just reloads all tags on every page refresh
                        // We'll need to refine this once AJAX updates start happening
                        thumbprint: new Date().getTime(),
                        url: '/tags',
                        filter: function(data) {
                            return data.tags;
                        }
                    }
                });

                tags.initialize();

                $('#q, #tags').tagInput({
                    allowDuplicates: false,
                    typeahead: true,
                    typeaheadOptions: {
                        highlight: true
                    },
                    typeaheadDatasetOptions: {
                        displayKey: 'tag',
                        source: tags.ttAdapter()
                    }
                });

                $('#results a[rel="external"]').attr('target', '_blank');

                $('li.disabled a').on('click', function(e) { e.preventDefault(); });

            });

        </script>
        <script id="update-link-template" type="text/x-handlebars-template">

        </script>
    </body>
</html>